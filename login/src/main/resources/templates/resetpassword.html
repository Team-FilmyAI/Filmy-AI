<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Reset Password</title>
    <script>
        function validatePassword() {
            const password = document.getElementById("newPassword").value;
            const confirmPassword = document.getElementById("confirmPassword").value;
            const message = document.getElementById("clientMessage");

            // Password strength conditions
            const minLength = password.length >= 8;
            const hasUpperCase = /[A-Z]/.test(password);
            const hasLowerCase = /[a-z]/.test(password);
            const hasNumber = /\d/.test(password);

            // Validate password strength
            if (!minLength || !hasUpperCase || !hasLowerCase || !hasNumber) {
                message.style.color = "red";
                message.textContent = "Password must be at least 8 characters, contain an uppercase letter, a lowercase letter, and a number.";
                return false; // Prevent form submission
            }

            // Validate confirm password
            if (password !== confirmPassword) {
                message.style.color = "red";
                message.textContent = "Passwords do not match.";
                return false; // Prevent form submission
            }

            message.textContent = ""; // Clear the message if valid
            return true;
        }
    </script>
</head>
<body>
    <h1>Reset Your Password</h1>
    <!-- Display server-side messages -->
    <div th:if="${error}" style="color: red;" th:text="${error}"></div>
    <div th:if="${success}" style="color: green;" th:text="${success}"></div>

<form th:action="@{/api/auth/reset-password}" method="post" onsubmit="return validatePassword()">
    <!-- Hidden field to include the token -->
    <input type="hidden" name="token" th:value="${token}" />

    <!-- New Password Field -->
    <label for="newPassword">New Password:</label>
    <input type="password" id="newPassword" name="newPassword" required />

    <!-- Confirm Password Field -->
    <label for="confirmPassword">Confirm Password:</label>
    <input type="password" id="confirmPassword" name="confirmPassword" required />

    <p id="clientMessage" style="color: red;"></p> <!-- Display client-side validation messages -->

    <button type="submit">Reset Password</button>
</form>
</body>
</html>
